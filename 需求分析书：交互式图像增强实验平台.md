



# **需求分析书：交互式图像增强实验平台**

*   **版本**: 1.1
*   **日期**: 2025年8月11日
*   **文档状态**: 初稿定版

---

## 1. 项目概述与目标

### 1.1 项目简介
本项目旨在开发一个基于Python的桌面GUI应用程序，为工业领域的测试工程师提供一个交互式的图像增强实验与教学平台。该平台允许用户加载16位的DICOM格式图像，通过一系列经典图像处理步骤进行增强，并能直观地对比、理解每一步操作对图像带来的变化。

### 1.2 项目目标
*   **核心目标**: 打造一个直观的教学与实验工具，帮助用户系统性地理解和掌握主流的图像增强技术。
*   **功能目标**: 提供一个包含多种经典增强算法（如灰度变换、滤波、直方图调整等）的集成环境，支持参数调整和实时预览。
*   **体验目标**: 实现一个清晰、无歧押的交互流程，支持“顺序处理流水线”和“单独处理”两种模式，并能通过双窗口对比，直观展示增强效果。
*   **技术目标**: 利用`PyQt5`构建GUI界面，`pydicom`处理DICOM文件，并以`scikit-image`为核心实现高质量的图像增强算法。

---

## 2. 用户画像与核心场景

### 2.1 目标用户
*   **用户画像**: 有一定经验的工业领域（如NDT、材料分析等）的测试工程师。
*   **用户特点**: 具备基础的图像概念，但不一定是图像处理算法专家。他们需要一个工具来快速实验不同增强方法对他们特定图像的效果，以找到最佳的检测前处理方案。
*   **用户痛点**: 缺乏一个集成的、可交互的平台来系统性地学习和对比不同增强算法，现有软件要么是“黑盒”，要么需要编写代码，不够直观。

### 2.2 核心使用场景
**场景一：系统性学习**
用户加载一张带有微小缺陷的原始DICOM图像。他希望了解从降噪到锐化的标准流程。他首先应用“高斯降噪”，然后在降噪结果的基础上应用“USM锐化”。通过双窗口对比，他能清晰地看到噪声被抑制且缺陷边缘更清晰的全过程。

**场景二：算法对比实验**
用户想对比“全局直方图均衡”和“CLAHE”对图像局部对比度的影响。他首先对原始图像应用“全局均衡”，观察并保存结果。然后，他选择对“原始图像”应用“CLAHE”，再次观察结果。通过对比两张处理后的图像，他得出结论：CLAHE对他的图像细节增强效果更好。

**场景三：细节检查**
用户在对一张焊接件图像进行增强后，怀疑某个区域有微小的气孔。他使用鼠标滚轮，以该区域为中心放大图像，然后拖动图像仔细检查。为了精确对比，他激活“视图同步”功能，在原始图像窗口也放大到相同区域，从而清晰地分辨出该特征是原始缺陷还是算法伪影。

---

## 3. 核心功能需求 (Functional Requirements)

### 3.1 界面布局与核心组件
*   **FR-1: 主窗口布局**
    *   应采用**双窗口对比布局**。
    *   **左侧窗口 (原始图像窗口)**: 固定显示最初加载的、未经任何修改的原始图像。
    *   **右侧窗口 (处理结果窗口)**: 显示“当前正在处理的图像”的预览效果。
    *   **控制面板**: 位于界面一侧或下方，包含所有可用的增强功能模块和参数调整控件。
    *   **处理流水线/历史记录面板**: 清晰地展示当前已执行的操作序列。

### 3.2 图像加载与视图控制
*   **FR-2: 图像加载**
    *   提供一个“加载DICOM”按钮或菜单项，允许用户通过文件对话框选择并加载一个`.dcm`格式的文件。
    *   加载后，图像应在左侧“原始图像窗口”和右侧“处理结果窗口”同时显示。此时，“当前处理图像”即为“原始图像”。

*   **FR-3: 图像视图交互 (缩放与拖放)**
    *   **FR-3.1: 鼠标滚轮缩放**: 当鼠标指针悬停在任一图像窗口上时，向前滚动放大，向后滚动缩小，缩放以鼠标指针位置为中心。需设定合理的缩放范围。
    *   **FR-3.2: 鼠标拖放平移**: 当图像被放大到超出窗口时，用户可通过按住鼠标左键（或中键）并拖动来平移图像。鼠标光标应变为“抓手”图标。
    *   **FR-3.3: 视图重置/适应窗口**: 提供一个快捷操作（如按钮或双击），将图像的缩放与位置重置，使其完整、居中地显示在窗口内。
    *   **FR-3.4: 视图同步 (可选，但建议)**: 提供一个“同步视图”开关。激活后，在一个窗口的缩放/拖放操作将同步应用到另一个窗口，便于精确对比。

*   **FR-4: 窗宽窗位动态调节**
    *   提供两个滑块（Slider）或输入框，分别用于调整窗宽（Window Width）和窗位（Window Level）。
    *   当用户调整时，**右侧的处理结果窗口**应实时更新显示效果。此操作仅影响预览，不改变底层的16位数据。

### 3.3 图像增强模块
*   **FR-5: 增强操作逻辑**
    *   **当前处理图像**: 系统内部需维护一个“当前处理图像”的16位数据缓存。所有增强操作都基于此缓存进行。
    *   **顺序执行**: 当用户在增强模块上点击“应用”时，该操作将作用于“当前处理图像”，并将生成的结果更新为新的“当前处理图像”。该操作被添加到“处理流水线”末端。
    *   **单独执行**: 提供一个“重置为原始图像”按钮，点击后，“当前处理图像”被重置为最初加载的原始图像，同时清空“处理流水线”。
    *   **流水线/历史记录**: 面板中应显示操作序列，并提供“撤销”功能，允许回退到上一步状态。

*   **FR-6: 具体增强模块与参数 (基于 scikit-image)**
    *   **模块1：灰度变换**:
        *   **Gamma校正**: 提供滑块调整`gamma`值 (如0.1 - 5.0)。
    *   **模块2：直方图调整**:
        *   **全局均衡化 (`exposure.equalize_hist`)**: 一个“应用”按钮。
        *   **CLAHE (`exposure.equalize_adapthist`)**: 提供滑块调整`clip_limit` (如0.01 - 0.1)。
    *   **模块3：空间域滤波**:
        *   **降噪**:
            *   **高斯滤波 (`filters.gaussian`)**: 滑块调整`sigma` (如0.5 - 10)。
            *   **中值滤波 (`filters.median`)**: 滑块调整`disk size` (如1 - 10)。
        *   **锐化**:
            *   **非锐化掩模 (USM, `filters.unsharp_mask`)**: 滑块调整`radius`和`amount`。
    *   **模块4：形态学操作 (`morphology`)**:
        *   提供“腐蚀”、“膨胀”、“开运算”、“闭运算”按钮。
        *   提供滑块调整形态学核的大小 (`disk size`)。
    *   **模块5：频域增强 (可选高级功能)**:
        *   提供简化的“低通滤波”和“高通滤波”选项。

### 3.4 图像保存
*   **FR-7: 保存高精度结果**
    *   在每个增强模块处理完成后，旁边应有一个“保存此步结果”的按钮。
    *   点击后，将**当前步骤生成的16位高精度数据**以DICOM格式保存。保存的DICOM应尽可能地保留原始文件的元数据。
*   **FR-8: 保存预览图像**
    *   在右侧“处理结果窗口”下方，提供一个“保存预览图”按钮。
    *   点击后，将当前窗口显示的**8位“所见即所得”的图像**保存为PNG或JPEG格式。

---

## 4. 非功能性需求 (Non-Functional Requirements)

*   **NFR-1: 性能**: 视图交互（缩放/拖放）和窗宽窗位调整必须流畅。简单增强操作应实时响应。复杂操作（如高级降噪）允许有数秒延迟，但期间应有“处理中”的视觉反馈。
*   **NFR-2: 易用性**: 界面布局清晰，控件标签明确，交互逻辑符合用户直觉。关键参数提供合理的默认值。
*   **NFR-3: 稳定性**: 程序不应因无效操作或参数错误而崩溃，应有适当的错误处理和提示。

---

## 5. 范围边界与非目标

*   **非目标-1**: 不支持批量处理文件夹中的多张图像。
*   **非目标-2**: 本版本仅支持DICOM (.dcm) 格式作为输入。
*   **非目标-3**: 不包含图像分割、测量、配准或3D渲染功能。
*   **非目标-4**: 不支持用户自定义算法或插件系统。

---

## 6. 技术栈与实现考量

*   **编程语言**: Python 3.8+
*   **GUI框架**: PyQt5
*   **DICOM处理**: pydicom
*   **核心图像处理**: scikit-image, NumPy
*   **数据显示与绘图**: Matplotlib (嵌入PyQt5) 或 PyQtGraph (性能更佳) 或直接使用PyQt的QGraphicsView。

---

## 7. 任务清单 (Task Breakdown)

### Phase 1: 基础框架与核心功能 (MVP)
*   [ ] **T1.1**: 搭建PyQt5主窗口，实现双窗口（左右布局）和控制面板的基本框架。
*   [ ] **T1.2**: 实现“加载DICOM”功能，并在左右窗口正确显示图像。
*   [ ] **T1.3**: **实现图像视图交互**：在图像显示控件中加入鼠标滚轮缩放和拖放平移功能。
*   [ ] **T1.4**: **实现视图重置功能**：提供按钮或快捷方式让图像适应窗口。
*   [ ] **T1.5**: 实现窗宽窗位的滑块，并与右侧窗口的显示实时联动。
*   [ ] **T1.6**: 建立核心数据管理逻辑：管理“原始图像”和“当前处理图像”的16位数据。
*   [ ] **T1.7**: 实现第一个增强模块：**灰度变换 (Gamma校正)**，包括参数滑块和“应用”按钮。
*   [ ] **T1.8**: 实现处理流水线的基本逻辑：应用操作后更新“当前处理图像”和历史记录。
*   [ ] **T1.9**: 实现两种保存功能：保存16位DICOM和保存8位PNG。

### Phase 2: 丰富增强算法库
*   [ ] **T2.1**: 集成**直方图调整**模块 (全局均衡, CLAHE) 及参数控件。
*   [ ] **T2.2**: 集成**空间域滤波**模块 (高斯/中值降噪, USM锐化) 及参数控件。
*   [ ] **T2.3**: 集成**形态学操作**模块及参数控件。
*   [ ] **T2.4**: 完善历史记录面板，实现“撤销”和“重置为原始图像”功能。

### Phase 3: 优化与完善
*   [ ] **T3.1**: 对耗时操作添加“处理中”的用户反馈（如等待光标、状态栏提示）。
*   [ ] **T3.2**: **实现视图同步功能**：添加“同步视图”开关，并实现两个窗口的视图联动。
*   [ ] **T3.3**: （可选）集成频域增强模块。
*   [ ] **T3.4**: UI美化与布局优化，添加程序图标和菜单栏。
*   [ ] **T3.5**: 进行全面的测试，修复Bug。
*   [ ] **T3.6**: 编写简单的用户帮助文档或在界面上提供Tooltips提示。

---
